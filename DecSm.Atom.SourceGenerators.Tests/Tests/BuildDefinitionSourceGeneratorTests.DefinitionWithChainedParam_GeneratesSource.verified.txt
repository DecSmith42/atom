// <auto-generated/>

#nullable enable

global using static TestNamespace.ChainedParamBuild;
using System.Diagnostics.CodeAnalysis;
using System.Linq.Expressions;
using Microsoft.Extensions.DependencyInjection;
using Microsoft.Extensions.Logging;
using DecSm.Atom.Build.Definition;
using DecSm.Atom.Params;
using DecSm.Atom.Paths;
using DecSm.Atom.Process;

namespace TestNamespace;

[JetBrains.Annotations.PublicAPI]
partial class ChainedParamBuild : DecSm.Atom.Build.Definition.BuildDefinition
{
    private System.Collections.Generic.IReadOnlyDictionary<string, DecSm.Atom.Build.Definition.Target>? _targetDefinitions;

    public ChainedParamBuild(System.IServiceProvider services) : base(services) { }

    private ILogger Logger => Services.GetRequiredService<ILoggerFactory>().CreateLogger("TestNamespace.ChainedParamBuild");

    private IAtomFileSystem FileSystem => GetService<IAtomFileSystem>();

    private IProcessRunner ProcessRunner => GetService<IProcessRunner>();

    private T GetService<[DynamicallyAccessedMembers(DynamicallyAccessedMemberTypes.Interfaces)] T>()
        where T : notnull =>
        typeof(T).GetInterface(nameof(IBuildDefinition)) != null
            ? (T)(IBuildDefinition)this
            : Services.GetRequiredService<T>();

   private IEnumerable<T> GetServices<[DynamicallyAccessedMembers(DynamicallyAccessedMemberTypes.Interfaces)] T>()
        where T : notnull =>
        typeof(T).GetInterface(nameof(IBuildDefinition)) != null
            ? [(T)(IBuildDefinition)this]
            : Services.GetServices<T>();

    [return: NotNullIfNotNull(nameof(defaultValue))]
    private T? GetParam<[DynamicallyAccessedMembers(DynamicallyAccessedMemberTypes.All)] T>(Expression<Func<T?>> parameterExpression, T? defaultValue = default, Func<string?, T?>? converter = null) =>
        Services
            .GetRequiredService<IParamService>()
            .GetParam(parameterExpression, defaultValue, converter);


    public override System.Collections.Generic.IReadOnlyDictionary<string, DecSm.Atom.Build.Definition.Target> TargetDefinitions => _targetDefinitions ??= new System.Collections.Generic.Dictionary<string, DecSm.Atom.Build.Definition.Target>
    {
        { "ChainedParamTarget", ((TestNamespace.IChainedParamTarget)this).ChainedParamTarget },
    };

    public override System.Collections.Generic.IReadOnlyDictionary<string, DecSm.Atom.Params.ParamDefinition> ParamDefinitions { get; } = new System.Collections.Generic.Dictionary<string, DecSm.Atom.Params.ParamDefinition>
    {
        {
            "Param1", new("Param1")
            {
                ArgName = "param-1",
                Description = "Param 1",
                Sources = (DecSm.Atom.Params.ParamSource)47,
                IsSecret = false,
                ChainedParams = [],
            }
        },
        {
            "Param2", new("Param2")
            {
                ArgName = "param-2",
                Description = "Param 2",
                Sources = (DecSm.Atom.Params.ParamSource)47,
                IsSecret = false,
                ChainedParams = [ "Param1" ],
            }
        },
    };

    public override object? AccessParam(string paramName) =>
        paramName switch
        {
            "Param1" => ((TestNamespace.IChainedParamTarget)this).Param1,
            "Param2" => ((TestNamespace.IChainedParamTarget)this).Param2,
        _ => throw new System.ArgumentException($"Param with name '{paramName}' is not defined in the build definition.", nameof(paramName)),
        };

    [JetBrains.Annotations.PublicAPI]
    private static class Targets
    {
        public static DecSm.Atom.Workflows.Definition.WorkflowTargetDefinition ChainedParamTarget = new("ChainedParamTarget");
    }

    private static DecSm.Atom.Workflows.Definition.WorkflowTargetDefinition Target(string name) => name switch
    {
        "ChainedParamTarget" => Targets.ChainedParamTarget,
        _ => throw new System.ArgumentException($"Target with name '{name}' is not defined in the build definition.", nameof(name)),
    };

    [JetBrains.Annotations.PublicAPI]
    private static class Params
    {
        public static string Param1 = "Param1";
        public static string Param2 = "Param2";
    }

    // Build has no defined HostBuilder configuration

    // Build has no defined Host configuration
}
