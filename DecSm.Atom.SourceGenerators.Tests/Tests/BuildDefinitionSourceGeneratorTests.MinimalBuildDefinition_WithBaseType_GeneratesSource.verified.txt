// <auto-generated/>

#nullable enable

global using static TestNamespace.MinimalTestDefinition;

using System.Diagnostics.CodeAnalysis;
using System.Linq.Expressions;
using Microsoft.Extensions.DependencyInjection;
using Microsoft.Extensions.Logging;
using DecSm.Atom.Build.Definition;
using DecSm.Atom.Params;
using DecSm.Atom.Paths;
using DecSm.Atom.Process;

namespace TestNamespace;

[JetBrains.Annotations.PublicAPI]
partial class MinimalTestDefinition : DecSm.Atom.Build.Definition.IBuildDefinition
{
    public MinimalTestDefinition(System.IServiceProvider services) : base(services) { }

    private ILogger Logger => Services.GetRequiredService<ILoggerFactory>().CreateLogger("TestNamespace.MinimalTestDefinition");

    private IAtomFileSystem FileSystem => GetService<IAtomFileSystem>();

    private IProcessRunner ProcessRunner => GetService<IProcessRunner>();

    private T GetService<[DynamicallyAccessedMembers(DynamicallyAccessedMemberTypes.Interfaces)] T>()
        where T : notnull =>
        typeof(T).GetInterface(nameof(IBuildDefinition)) != null
            ? (T)(IBuildDefinition)this
            : Services.GetRequiredService<T>();

    private IEnumerable<T> GetServices<[DynamicallyAccessedMembers(DynamicallyAccessedMemberTypes.Interfaces)] T>()
        where T : notnull =>
        typeof(T).GetInterface(nameof(IBuildDefinition)) != null
            ? [(T)(IBuildDefinition)this]
            : Services.GetServices<T>();

    [return: NotNullIfNotNull(nameof(defaultValue))]
    private T? GetParam<[DynamicallyAccessedMembers(DynamicallyAccessedMemberTypes.All)] T>(
        Expression<Func<T?>> parameterExpression,
        T? defaultValue = default,
        Func<string?, T?>? converter = null) =>
            Services
                .GetRequiredService<IParamService>()
                .GetParam(parameterExpression, defaultValue, converter);

    #region Targets

    public override System.Collections.Generic.IReadOnlyDictionary<string, DecSm.Atom.Build.Definition.Target> TargetDefinitions { get; } = new System.Collections.Generic.Dictionary<string, DecSm.Atom.Build.Definition.Target>();

private static DecSm.Atom.Workflows.Definition.WorkflowTargetDefinition Target(string name) => throw new System.ArgumentException($"Target with name '{name}' is not defined in the build definition.", nameof(name));

    #endregion Targets

    #region Params

    public override System.Collections.Generic.IReadOnlyDictionary<string, DecSm.Atom.Params.ParamDefinition> ParamDefinitions { get; } = new System.Collections.Generic.Dictionary<string, DecSm.Atom.Params.ParamDefinition>();

    public sealed class ParamsData() { }

    private ParamsData? _params;

    public ParamsData WorkflowParams => _params ??= new();

    public override object? AccessParam(string paramName) => throw new System.ArgumentException($"Param with name '{paramName}' is not defined in the build definition.", nameof(paramName));

    #endregion Params
}
