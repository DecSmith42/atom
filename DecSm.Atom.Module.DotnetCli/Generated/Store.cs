// <auto-generated/>

#nullable enable

using DecSm.Atom.Paths;
using DecSm.Atom.Process;
using JetBrains.Annotations;

namespace DecSm.Atom.Module.DotnetCli;

public partial interface IDotnetCli
{
    /// <summary>
    ///     Stores the specified assemblies for the .NET Platform. By default, these will be optimized for the target runtime and framework.
    /// </summary>
    /// <param name="options">
    ///     Options
    /// </param>
    /// <param name="cancellationToken">
    ///     Cancellation token
    /// </param>
    public Task<ProcessRunResult> Store(
        System.String argument,
        StoreOptions? options = null,
        CancellationToken cancellationToken = default
    );
    
}

internal partial class DotnetCli : IDotnetCli
{
    public Task<ProcessRunResult> Store(
        System.String argument,
        StoreOptions? options = null,
        CancellationToken cancellationToken = default
    ) =>
        processRunner.RunAsync(new("dotnet",
            string.Join(' ', [
                "store",
                argument,
                options?.ToString(),
            ])), cancellationToken);
    
}

[PublicAPI]
public sealed record StoreOptions
{
    /// <summary>
    ///     Force the command to ignore any persistent build servers.
    /// </summary>
    public System.Boolean? DisableBuildServers
    {
        get;
        init;
    }
    
    /// <summary>
    ///     The target framework to store packages for. The target framework has to be specified in the project file.
    /// </summary>
    public System.String? Framework
    {
        get;
        init;
    }
    
    /// <summary>
    ///     The Microsoft.NETCore.App package version that will be used to run the assemblies.
    /// </summary>
    public System.String? FrameworkVersion
    {
        get;
        init;
    }
    
    /// <summary>
    ///     The XML file that contains the list of packages to be stored.
    /// </summary>
    public string? Manifest
    {
        get;
        init;
    }
    
    /// <summary>
    ///     The output directory to store the given assemblies in.
    /// </summary>
    public System.String? Output
    {
        get;
        init;
    }
    
    /// <summary>
    ///     The target runtime to store packages for.
    /// </summary>
    public System.String? Runtime
    {
        get;
        init;
    }
    
    /// <summary>
    ///     Skip the optimization phase.
    /// </summary>
    public System.Boolean? SkipOptimization
    {
        get;
        init;
    }
    
    /// <summary>
    ///     Skip creating symbol files which can be used for profiling the optimized assemblies.
    /// </summary>
    public System.Boolean? SkipSymbols
    {
        get;
        init;
    }
    
    /// <summary>
    ///     Use current runtime as the target runtime.
    /// </summary>
    public System.Boolean? UseCurrentRuntime
    {
        get;
        init;
    }
    
    /// <summary>
    ///     Set the MSBuild verbosity level. Allowed values are q[uiet], m[inimal], n[ormal], d[etailed], and diag[nostic].
    /// </summary>
    public string? Verbosity
    {
        get;
        init;
    }
    
    /// <summary>
    ///     The working directory used by the command to execute.
    /// </summary>
    public System.String? WorkingDir
    {
        get;
        init;
    }
    
    public override string ToString()    {
        return string.Join(' ',
        new[]
        {
            DisableBuildServers is true
                ? "--disable-build-servers"
                : null,
            Framework is not null
                ? $"--framework {Framework}"
                : null,
            FrameworkVersion is not null
                ? $"--framework-version {FrameworkVersion}"
                : null,
            Manifest is not null
                ? $"--manifest {Manifest}"
                : null,
            Output is not null
                ? $"--output {Output}"
                : null,
            Runtime is not null
                ? $"--runtime {Runtime}"
                : null,
            SkipOptimization is true
                ? "--skip-optimization"
                : null,
            SkipSymbols is true
                ? "--skip-symbols"
                : null,
            UseCurrentRuntime is true
                ? "--use-current-runtime"
                : null,
            Verbosity is not null
                ? $"--verbosity {Verbosity}"
                : null,
            WorkingDir is not null
                ? $"--working-dir {WorkingDir}"
                : null,
        }
        );
    }
    
}

